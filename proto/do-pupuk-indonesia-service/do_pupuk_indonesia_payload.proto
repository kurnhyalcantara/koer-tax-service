syntax = "proto3";

package do_pupuk_indonesia.service.v1;

option go_package = "./pb";

import "do-pupuk-indonesia-service/do_pupuk_indonesia_core.proto";
import "mwitkow/go-proto-validators/validator.proto";
import "google/protobuf/timestamp.proto";
import "protoc-gen-openapiv2/options/annotations.proto";



/* #region payload for outbound esb  */
message EsbInquiryRequest {
  EsbInquiryRequestData request = 1;
}

message EsbInquiryRequestData {
  string external_id = 1 [json_name = "externalId"];
  string cust_number = 2 [json_name = "custNumber"];
  string terminal_id = 3 [json_name = "terminalId"];
  string card_number = 4 [json_name = "cardNumber"];
  string channel_id = 5 [json_name = "channelId"];
  string product_code = 6 [json_name = "productCode"];
  string remark2 = 7;
  string remark3 = 8;
}

message EsbInquiryResponse {
  EsbInquiryResponseData response = 1;
  string error_code = 2 [json_name = "errorCode"];
  string response_code = 3 [json_name = "responseCode"];
  string response_message = 4 [json_name = "responseMessage"];
}

message EsbInquiryResponseData {
  string error_code = 1 [json_name = "errorCode"];
  string response_code = 2 [json_name = "responseCode"];
  string response_message = 3 [json_name = "responseMessage"];
  EsbInquiryResponseDataData data = 4;
}

message EsbInquiryResponseDataData {
  string inquiry_id = 1 [json_name = "inquiryId"];
  string biller_code = 2 [json_name = "billerCode"];
  string cust_number = 3 [json_name = "custNumber"];
  string cust_name = 4 [json_name = "custName"];
  string batas_ambil = 5 [json_name = "batasAmbil"];
  string tujuan = 6;
  string product_code = 7 [json_name = "productCode"];
  string amount = 8;
  string currency = 9;
  string product_name = 10 [json_name = "productName"];
  repeated EsbCustomerDetail customer_details = 11 [json_name = "customerDetails"];
  repeated EsbProductDetail product_details = 12 [json_name = "productDetails"];
  EsbBillData bill_data = 13 [json_name = "billData"];
  string fee = 14;
}

message EsbCustomerDetail {
  string key = 1;
  string value = 2;
}

message EsbProductDetail {
  string key = 1;
  string value = 2;
}

message EsbBillData {
  string trx_id = 1 [json_name = "trxId"];
  string rq_uuid = 2 [json_name = "rqUuid"];
  string bill_info1 = 3 [json_name = "billInfo1"];
  string bill_code = 4 [json_name = "billCode"];
  string bank_account_no = 5 [json_name = "bankAccountNo"];
  string sales_order_number = 6 [json_name = "salesOrderNumber"];
  string company_name = 7 [json_name = "companyName"];
  string booking_time_limit = 8 [json_name = "bookingTimeLimit"];
  string cust_name = 9 [json_name = "custName"];
  string batas_ambil = 10 [json_name = "batasAmbil"];
  string tujuan = 11;
  string comm_code = 12 [json_name = "commCode"];
  string gudang = 13;
  string produk = 14;
}

message EsbPaymentRequest {
  EsbPaymentRequestData request = 1;
}

message EsbPaymentRequestData {
  string external_id = 1 [json_name = "externalId"];
  string cust_number = 2 [json_name = "custNumber"];
  string product_code = 3 [json_name = "productCode"];
  string account_number = 4 [json_name = "accountNumber"];
  string channel_id = 5 [json_name = "channelId"];
  string card_number = 6 [json_name = "cardNumber"];
  string terminal_id = 7 [json_name = "terminalId"];
  string terminal_info = 8 [json_name = "terminalInfo"];
  string amount = 9;
  string credit_account = 10 [json_name = "creditAccount"];
  string inquiry_id = 11 [json_name = "inquiryId"];
  EsbPaymentBillData bill_data = 12 [json_name = "billData"];
}

message EsbPaymentBillData {
  string batas_ambil = 1 [json_name = "batasAmbil"];
  string booking_time_limit = 2 [json_name = "bookingTimeLimit"];
  string comm_code = 3 [json_name = "commCode"];
  string company_name = 4 [json_name = "companyName"];
  string cust_name = 5 [json_name = "custName"];
  string gudang = 6;
  string produk = 7;
  string sales_order_number = 8 [json_name = "salesOrderNumber"];
  string tujuan = 9;
}

message EsbPaymentResponse {
  EsbPaymentResponseData response = 1;
}

message EsbPaymentResponseData {
  string error_code = 1 [json_name = "errorCode"];
  string response_code = 2 [json_name = "responseCode"];
  string response_message = 3 [json_name = "responseMessage"];
  EsbPaymentResponseDataData data = 4;
}

message EsbPaymentResponseDataData {
  string journal_sequence = 1 [json_name = "journalSequence"];
  string tran_code = 2 [json_name = "tranCode"];
  string need_approval = 3 [json_name = "needApproval"];
  string biller_code = 4 [json_name = "billerCode"];
  string fee = 5;
  string cust_number = 6 [json_name = "custNumber"];
  string cust_name = 7 [json_name = "custName"];
  string product_code = 8 [json_name = "productCode"];
  string amount = 9;
  repeated EsbPaymentReceiptInfo receipt_info = 10 [json_name = "receiptInfo"];
  repeated EsbCustomerDetail customer_details = 11 [json_name = "customerDetails"];
  repeated EsbProductDetail product_details = 12 [json_name = "productDetails"];
  EsbPaymentResponseBillData bill_data = 13 [json_name = "billData"];
}

message EsbPaymentReceiptInfo {
  string key = 1;
  string value = 2;
}

message EsbPaymentResponseBillData {
  string trx_id = 1 [json_name = "trxId"];
  string rq_uuid = 2 [json_name = "rqUuid"];
  string bill_info1 = 3 [json_name = "billInfo1"];
  string bill_code = 4 [json_name = "billCode"];
  string bank_account_no = 5 [json_name = "bankAccountNo"];
  string sales_order_number = 6 [json_name = "salesOrderNumber"];
  string company_name = 7 [json_name = "companyName"];
  string booking_time_limit = 8 [json_name = "bookingTimeLimit"];
  string cust_name = 9 [json_name = "custName"];
  string batas_ambil = 10 [json_name = "batasAmbil"];
  string tujuan = 11;
  string comm_code = 12 [json_name = "commCode"];
  string gudang = 13;
}
/* #end region */

/* #region basic Payload */
message ErrorBodyResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
}

message HealthCheckResponse{
  bool error = 1;
  uint32 code = 2;
  string message = 3;
}

message Sort {
  string column = 1;
  string direction = 2;
}

message PaginationRequest {
  int32 limit = 1;
  int32 page = 2;
  string search = 3;
}

message SubmitDOPupukIndonesiaRequest {
  bool is_draft = 1;
  repeated OrderRequest order_request = 2 [(validator.field) = {repeated_count_min: 1}];
}

message UpdateDOPupukIndonesiaRequest {
  bool is_draft = 1;
  uint64 task_id = 2;
  OrderRequest order_request = 3;
}

message OrderRequest {
  string booking_code = 1 [(validator.field) = {regex: "^[0-9]+$"}];
  string debit_account = 2 [(validator.field) = {string_not_empty: true}];
  ScheduleType schedule_type = 3 [(validator.field) = {is_in_enum: true}];
  string schedule_date = 4;
  string schedule_time = 5;
}

message SubmitDOPupukIndonesiaResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
}

message SaveTaskDOPupukIndonesiaResponse {
  uint64 task_id = 1;
  string transaction_id = 2;
  Status status = 3;
}

message OrderDetailRequest {
  string transaction_id = 1;
}

message OrderDetailResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
  OrderDataDetail data = 4;
}

message OrderDataDetail {
  TransactionInformationResponse transaction_information = 1;
  TaskDetailResponse task = 2;
  string workflow_doc = 3;
  ProductDetailResponse product_detail = 4;
}

message TransactionInformationResponse {
  string transaction_id = 1;
  string booking_code = 2;
  string sales_order_number = 3;
  string pickup_deadline = 4;
  string booking_time_limit = 5;
  string debit_account_number = 6;
  string debit_account_name = 7;
  double amount = 8;
  double fee = 9;
  double total_amount = 10;
  string booking_name = 11;
  string company_name_inquiry = 12;
  string destination = 13;
  string warehouse = 14;
  Status status = 15;
  string description_message = 16;
  ScheduleType schedule_type = 17;
  string schedule_date = 18;
  string schedule_time = 19;
  double fee_inquiry = 20;
}

message TaskDetailResponse {
  uint64 task_id = 1;
  string status = 2;
  string reasons = 3;
  string last_approved_by_name = 4;
  string last_rejected_by_name = 5;
  string updated_by_name = 6;
  string created_by_name = 7;
  string type = 8;
  string comment = 9;
  string created_at = 101;
  string updated_at = 102;
  string approved_at = 104;
  string rejected_at = 105;
}

message ProductDetailResponse {
  uint32 total_item = 1;
  repeated string products = 2; 
}

message ScheduledPaymentResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
}

message CheckDebitAccountRequest {
  string account_number = 1;
}

message CheckDebitAccountResponse {
  string available_bal = 1;
  string account_type = 2;
  string account_name = 3;
}

message InquiryRequest {
  string booking_code = 1;

  // TODO: remove when ESB is ready
  string response_type = 2;
  bool is_edit = 3;
}

message InquiryResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
  InquiryData data = 4;
}

message InquiryData {
  string company_name_inquiry = 1;
  string booking_time_limit = 2;
  string pickup_deadline = 3;
  string destination = 4;
  string warehouse = 5;
  string amount = 6;
  string fee = 7;
  string total_amount = 8;
  string products = 9;
  string sales_order_number = 10;
  string cust_number = 11;
  string cust_name = 12;
  string alert_message = 13;
  string alert_variant = 14;
}

message Alert {
  string message = 1;
  string variant = 2;
}

message PaymentRequest {
  uint64 order_id = 1;
  string inquiry_id = 2;
	string account_number = 3;
	string cust_number = 4;
	string amount = 5;
	string product_code = 6;
	string batas_ambil = 7;
	string booking_time_limit = 8;
	string comm_code = 9;
	string company_name = 10;
	string cust_name = 11;
	string gudang = 12;
	string produk = 13;
	string so_number = 14;
	string tujuan = 15;
  uint64 task_id = 16;
  string credit_account = 17;
  string fee = 18;
}

message failedPaymentScheduledRequest {
  uint64 task_id = 1;
  Status status = 2;
  string description_message = 3;
}
/* #end region */

/* #region task payload */
message TaskDataDOPupukIndonesia {
  uint64 order_id = 1;
  string transaction_id = 2;
  Status status = 3;
  string booking_code = 4;
  uint64 company_id = 5;
  string company_name_inquiry = 6;
  string sales_order_number = 7;
  string booking_time_limit = 8;
  string pickup_deadline = 9;
  string destination = 10;
  string warehouse = 11;
  double amount = 12;
  double fee = 13;
  double total_amount = 14;
  string products = 15;
  ScheduleType schedule_type = 16;
  string debit_account = 17;
  string debit_account_name = 18;
  string debit_account_type = 19;
  string schedule_date = 20;
  string booking_name = 21;
  string description_message = 22;
};

message DeleteTaskRequest {
  repeated uint64 task_ids = 1 [(validator.field) = {repeated_count_min: 1}];
}

message DeleteTaskResponse {
  bool error = 1;
  uint32 code = 2;    
  string message = 3;
  int32 total_successful = 4;
  int32 total_failed = 5;
  repeated DeleteTaskResponses data = 6;
}

message DeleteTaskResponses {
  bool error = 1;
  string message = 2;
  DeletedTask task = 3;
}

message DeletedTask {
  uint64 task_id = 1;
}

message DownloadReceiptFileRequest {
  repeated string transaction_id = 1;
  string extension = 2; 
}

message ReceiptData {
  TaskDataDOPupukIndonesia order = 1;
  string updated_at = 2;
}

message ListModelData {
  string header_data = 1;
  repeated ModelData model_data = 2;
  bool is_table = 3;
  bool new_page = 4;
  TableSpec table_spec = 5;
  bool fill_page = 6;
}

message TableSpec {
  repeated uint32 column_width = 1; 
  repeated TableData table_data = 5;
}

message TableData {
  repeated string data = 2;
}

message ModelData {
  string key = 1;
  string value = 2;
  int32 len_char = 3;
  int32 height = 4;
  bool cut_dot = 5;
  bool is_total_payment = 6;
}
message SetStatusesTaskRequest {
  repeated uint64 task_ids = 1 [(validator.field) = {repeated_count_min: 1}];
  string action = 2 [
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
        description: "Action: 'approve', 'reject', 'rework"
    },
    (validator.field) = {string_not_empty: true}
  ];
  string comment = 3 [(validator.field) = {length_lt:101}];
  string reasons = 4 [(validator.field) = {length_lt:101}];
  string pass_code = 5;
}

message SetStatusesTaskResponse {
  bool error = 1;
  int32 code = 2;
  string message = 3;
  int32 total_successful = 4;
  int32 total_failed = 5;
  repeated TaskStatusResponse data = 6;
}

message TaskStatusResponse {
  bool error = 1;
  string message = 2;
  TaskActionResponse task = 3;
}

message TaskActionResponse {
  uint64 task_id = 1;
}

message ListTaskRequest {
  string status = 1;
  string filter = 2;
  string search = 3;
  int32 page = 4;
  int32 limit = 5 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "limit data per page. Default value '-1' for disable limit",
  }];
  string sort = 6 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Order data by column name",
    }];
  Direction dir = 7 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Sort Direction enum should be ASC or DESC",
    }];
  string filter_or = 8 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Create 'OR' queries \n format: [key:value,key:value] \n example: filter=created_at:>=2023-10-17,created_at:<=2023-10-18  => Where created_at >= 2023-10-17 AND created_at <= 2023-10-17 \n Expressions: \n - 'key:value' => 'key = value' \n - 'key:%%value' => 'key LIKE %value%' \n - 'key:%!value' => 'key ILIKE %value%' \n - 'key:>=value' => 'key >= value' \n - 'key:<=value' => 'key <= value' \n - 'key1:>=value1,key2:<=value2' => 'key1 >= value1 AND key2 <= value2' BETWEEN EXAMPLE \n - 'key1.nestedKey1:value' => 'key1->>nestedKey1 = value'",
    }];
  string query = 9 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Create 'OR' queries \n format: [key1,key2,key3:value] \n example: query=status:3,status:4 => Where status = 3 OR status = 4 \n Expressions: \n - 'key:value' => 'key = value' \n - 'key:%%value' => 'key LIKE %value%' \n - 'key:%!value' => 'key ILIKE %value%' \n - 'key1.nestedKey1:value' => 'key1->>nestedKey1 = value'",
    }];
  string typeTab = 10 [
      (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
          description: "Action: 'transaction', 'history'"
      }
  ];
}

message ListTaskResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
  repeated DataListTaskResponse data = 4;
  repeated SummaryTask summary = 5;
  PaginationResponse pagination = 6;
}

message DataListTaskResponse {
  TaskDataDOPupukIndonesia data = 1;
  Task task = 2;
}

message SummaryTask{
  string status = 1;
  int32 count = 2;
}

message Task {
  uint64 task_id = 1;
  string type = 2;
  string status = 3;
  string step = 4;
  uint64 created_by_id = 5;
  uint64 last_approved_by_id = 6;
  uint64 last_rejected_by_id = 7;
  string data = 8;
  string comment = 9;
  uint64 feature_id = 10;
  repeated Task childs = 11;
  bool is_parent_active = 12;
  string reasons = 13;
  string last_approved_by_name = 14;
  string last_rejected_by_name = 15;
  uint64 updated_by_id = 16;
  string updated_by_name = 17;
  string created_by_name = 18;
  string data_bak = 19;
  string child_bak = 20;
  string workflow_doc = 21;
  uint64 company_id = 22;
  uint64 holding_id = 23;
  google.protobuf.Timestamp created_at = 101;
  google.protobuf.Timestamp updated_at = 102;
  google.protobuf.Timestamp deleted_at = 103;
  google.protobuf.Timestamp approved_at = 104;
  google.protobuf.Timestamp rejected_at = 105;
}

message ListTaskFileRequest {
  string status = 1;
  string filter = 2;
  string search = 3;
  int32 page = 4;
  int32 limit = 5 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "limit data per page. Default value '-1' for disable limit",
  }];
  string sort = 6 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Order data by column name",
    }];
  Direction dir = 7 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Sort Direction enum should be ASC or DESC",
    }];
  string filter_or = 8 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Create 'OR' queries \n format: [key:value,key:value] \n example: filter=created_at:>=2023-10-17,created_at:<=2023-10-18  => Where created_at >= 2023-10-17 AND created_at <= 2023-10-17 \n Expressions: \n - 'key:value' => 'key = value' \n - 'key:%%value' => 'key LIKE %value%' \n - 'key:%!value' => 'key ILIKE %value%' \n - 'key:>=value' => 'key >= value' \n - 'key:<=value' => 'key <= value' \n - 'key1:>=value1,key2:<=value2' => 'key1 >= value1 AND key2 <= value2' BETWEEN EXAMPLE \n - 'key1.nestedKey1:value' => 'key1->>nestedKey1 = value'",
    }];
  string query = 9 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
      description: "Create 'OR' queries \n format: [key1,key2,key3:value] \n example: query=status:3,status:4 => Where status = 3 OR status = 4 \n Expressions: \n - 'key:value' => 'key = value' \n - 'key:%%value' => 'key LIKE %value%' \n - 'key:%!value' => 'key ILIKE %value%' \n - 'key1.nestedKey1:value' => 'key1->>nestedKey1 = value'",
    }];
  string typeTab = 10 [
      (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
          description: "Action: 'transaction', 'history'"
      }
  ];
  string file_format = 11;
}

message GetListFilterRequest {
  string field = 1;
  int32 page = 2;
  int32 limit = 3;
  string search = 4;
  string tab = 5;
}

message GetListFilterResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
  repeated string data = 4;
  PaginationResponse pagination = 5;
}
/* #end region */

/* #region email payload */
message NotificationData {
  string creation_date = 1 [json_name='CREATION_DATE'];
  string transaction_id = 2 [json_name='TRANSACTION_ID'];
  string booking_code = 3 [json_name='BOOKING_CODE'];
  string so_number = 4 [json_name='SO_NUMBER'];
  string company_name = 5 [json_name='COMPANY_NAME'];
  string debit_account_number = 6 [json_name='DEBIT_ACCOUNT_NUMBER'];
  string debit_account_name = 7 [json_name='DEBIT_ACCOUNT_NAME'];
  string total_amount = 8 [json_name='TOTAL_AMOUNT'];
  string transaction_status = 9 [json_name='TRANSACTION_STATUS'];
  string user_maker = 10 [json_name='USER_MAKER'];
  string reason = 11 [json_name='REASON'];
  string description_reject = 12 [json_name='DESCRIPTION_REJECT'];
  string reject_from = 13 [json_name='REJECT_FROM'];
  string description_rework = 14 [json_name='DESCRIPTION_REWORK'];
  string rework_from = 15 [json_name='REWORK_FROM'];
}
/* #end region */

message GetStatusGroupRequest {
  string tab = 1;
  string filter = 2;
  string query = 3;
}

message GetStatusGroupResponse {
  bool error = 1;
  uint32 code = 2;
  string message = 3;
  repeated StatusGroup data = 4;
}

message StatusGroup {
  string code = 1;
  string name = 2;
  uint64 count = 3;
  bool is_pending = 4;
}

message HistoryStatus {
  string status = 1;
  uint64 count = 2;
}

message AppKey {
  string app_key = 1;
}

message GetFeeFromMenuLicenseResponse {
  double fee_menu_license = 1;
}